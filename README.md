# sber_data_engineer_12_final  


Разработать ETL процесс, получающий ежедневную выгрузку данных
(предоставляется за 3 дня), загружающий ее в хранилище данных и ежедневно
строящий отчет.  
  
### Выгрузка данных.
Ежедневно некие информационные системы выгружают три следующих файла:
1. Список транзакций за текущий день. Формат – CSV.
2. Список терминалов полным срезом. Формат – XLSX.
3. Список паспортов, включенных в «черный список» - с накоплением с начала
месяца. Формат – XLSX.
  
### Структура хранилища.
В качестве хранилища выступает ваша учебная база (edu).
Данные должны быть загружены в хранилище со следующей структурой
(имена сущностей указаны по существу, без особенностей правил нейминга,
указанных далее):
![image](https://user-images.githubusercontent.com/101450815/223147702-e63dac6d-e8f6-42f9-9569-5fd4e0874224.png)  
Типы данных в полях можно изменять на однородные если для этого есть
необходимость. Имена полей менять нельзя. Ко всем таблицам SCD1 должны быть
добавлены технические поля create_dt, update_dt; ко всем таблицам SCD2 должны
быть добавлены технические поля `effective_from`, `effective_to`, `deleted_flg`.  
  
### Построение отчета.
По результатам загрузки ежедневно необходимо строить витрину отчетности
по мошенническим операциям. Витрина строится накоплением, каждый новый отчет
укладывается в эту же таблицу с новым report_dt.
В витрине должны содержаться следующие поля:  
![vtr](https://user-images.githubusercontent.com/101450815/223148202-6d0aab6b-813e-48f1-8333-41c9096d0df9.png)  

### Признаки мошеннических операций.  
1. Совершение операции при просроченном или заблокированном паспорте.
2. Совершение операции при недействующем договоре.
3. Совершение операций в разных городах в течение одного часа.
4. Попытка подбора суммы. В течение 20 минут проходит более 3х операций со
следующим шаблоном – каждая последующая меньше предыдущей, при этом
отклонены все кроме последней. Последняя операция (успешная) в такой цепочке
считается мошеннической.  
   
### Правила именования таблиц.
Необходимо придерживаться следующих правил именования (для
автоматизации проверки):  
![tp](https://user-images.githubusercontent.com/101450815/223148676-1bf8d46b-5718-4198-9cb7-62be11293ea4.png)  
  
### Обработка файлов  
Выгружаемые файлы именуются согласно следующему шаблону:
`transactions_DDMMYYYY.txt`
`passport_blacklist_DDMMYYYY.xlsx`
`terminals_DDMMYYYY.xlsx`
Предполагается что в один день приходит по одному такому файлу. После
загрузки соответствующего файла он должен быть переименован в файл с
расширением .backup чтобы при следующем запуске файл не искался и перемещен в
каталог archive:
`transactions_DDMMYYYY.txt.backup`
`passport_blacklist_DDMMYYYY.xlsx.backup`
`terminals_DDMMYYYY.xlsx.backup`
Желающие могут придумать, обосновать и реализовать более технологичные и
учитывающие сбои способы обработки (за это будет повышен балл).  
   
### Проверка результата.
Проверка задания состоит из нескольких частей, обязательных к
одновременному выполнению.
#### 1. Загрузка в classroom.  
В classroom выкладывается zip-архив, содержащий следующие файлы и каталоги:  
![t](https://user-images.githubusercontent.com/101450815/223149147-3dc1894d-c470-4f98-9798-53f99af89966.png)  
![t2](https://user-images.githubusercontent.com/101450815/223149305-a7cc1b07-7186-4b37-8a3c-014055185c92.png)  
  
#### 2. Данные в таблицах на сервере.  
Данные в ваших таблицах должны быть загружены за все три дня. Данные в
таблицах будут проверены автоматически исходя из правил наименования. Будьте
внимательны, если имя таблицы не соответствует выставленным требованиям –
проверка не происходит, считается что вы не отловили ни один из случаев.
#### 3. Код в вашем каталоге на ETL сервере.  
На сервере de-edu-etl.chronosavant.ru должен быть создан каталог
/home/de12/XXXX/project, где XXXX - 4 буквы вашего кода в нижнем регистре,
например /home/de12/seil/project. В каталоге должны быть выложены точно те же
файлы и каталоги, которые вы прислали на проверку в classroom. На файл main.py
должны быть выданы права на исполнение.

